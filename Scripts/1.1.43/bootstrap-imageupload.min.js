if(typeof jQuery=="undefined")throw new Error("bootstrap-imageupload's JavaScript requires jQuery.");(function(n){"use strict";function o(i){t=n.extend({},n.fn.imageupload.defaultOptions,i);var o=this,r=o.find(".file-tab"),h=o.find(".panel-heading .btn:eq(0)"),l=r.find('input[type="file"]'),a=r.find(".btn:eq(1)"),u=o.find(".url-tab"),v=o.find(".panel-heading .btn:eq(1)"),y=u.find(".btn:eq(0)"),k=u.find(".btn:eq(1)");f(r);e(u);c(r);s.call(o);h.off();l.off();a.off();v.off();y.off();k.off();h.on("click",function(){n(this).blur();c(r)});l.on("change",function(){n(this).blur();p(r)});a.on("click",function(){n(this).blur();f(r)});v.on("click",function(){n(this).blur();w(u)});y.on("click",function(){n(this).blur();b(u)});k.on("click",function(){n(this).blur();e(u)})}function l(){var n=this;n.addClass("imageupload-disabled")}function s(){var n=this;n.removeClass("imageupload-disabled")}function a(){var n=this;o.call(n,t)}function i(n){var t=[];return t.push('<div class="alert alert-danger alert-dismissible">'),t.push('<button type="button" class="close" data-dismiss="alert">'),t.push("<span>&times;<\/span>"),t.push("<\/button>"+n),t.push("<\/div>"),t.join("")}function h(n){return'<img src="'+n+'" alt="Image preview" class="thumbnail" style="max-width:142px;">'}function u(n){return n.substr(n.lastIndexOf(".")+1).toLowerCase()}function v(i,r){if(i.size/1024>t.maxFileSizeKb){r(!1,"File is too large (max "+t.maxFileSizeKb+"kB).");return}var f=u(i.name);n.inArray(f,t.allowedFormats)>-1?r(!0,"Image file is valid."):r(!1,"File type is not allowed.")}function y(i,r){var e=null,o=!1,f=new Image;f.onload=function(){var f,s;o||(window.clearTimeout(e),f=i,f.indexOf("?")!==-1&&(f=f.split("?")[0].split("#")[0]),s=u(f),n.inArray(s,t.allowedFormats)>-1?r(!0,"Image URL is valid."):r(!1,"File type is not allowed."))};f.onerror=function(){o||(window.clearTimeout(e),r(!1,"Image could not be found."))};f.src=i;e=window.setTimeout(function(){o=!0;f.src="???";r(!1,"Loading image timed out.")},3e3)}function c(n){var t=n.closest(".imageupload"),r=t.find(".panel-heading .btn:eq(0)"),i;r.hasClass("active")||(i=t.find(".url-tab"),t.find(".panel-heading .btn:eq(1)").removeClass("active"),r.addClass("active"),i.hide(),n.show(),e(i))}function f(n){n.find(".alert").remove();n.find(".btn span").text("Ajouter une photo");n.find(".btn:eq(1)").hide();n.find("input").val("")}function p(r){var f=r.find(".btn:eq(0)"),s=r.find(".btn:eq(1)"),e=f.find("input"),o;(r.find(".alert").remove(),r.find("img").remove(),f.find("span").text("Ajouter une photo"),s.hide(),e[0].files&&e[0].files[0])&&(f.prop("disabled",!0),o=e[0].files[0],v(o,function(c,l){if(c){var a=new FileReader;a.onload=function(i){f.find("span").text("Changer");s.css("display","inline-block");var e={param1:i.target.result,param2:u(o.name),param3:"IMG_USER",param6:"loadImagesUser"};n.ajax({url:"/Base/UploadFile",type:"POST",data:e,success:function(i){r.prepend(h(i));n("#infoUser_PhotoUrl").val(i);t.ajaxSuccessMethode!=null&&k(t.ajaxSuccessMethode,t.refreshImgByjaxSuccessMethode,i)}})};a.onerror=function(){r.prepend(i("Error loading image file."));e.val("")};a.readAsDataURL(o)}else r.prepend(i(l)),f.find("span").text("Ajouter une photo"),e.val("");f.prop("disabled",!1)}))}function w(n){var t=n.closest(".imageupload"),r=t.find(".panel-heading .btn:eq(1)"),i;r.hasClass("active")||(i=t.find(".file-tab"),t.find(".panel-heading .btn:eq(0)").removeClass("active"),r.addClass("active"),i.hide(),n.show(),f(i))}function e(n){n.find(".alert").remove();n.find("img").remove();n.find(".btn:eq(1)").hide();n.find("input").val("")}function b(t){var u=t.find('input[type="text"]'),f=t.find(".btn:eq(0)"),e=t.find(".btn:eq(1)"),r;if(t.find(".alert").remove(),t.find("img").remove(),e.hide(),r=u.val(),!r){t.prepend(i("Please enter an image URL."));return}u.prop("disabled",!0);f.prop("disabled",!0);y(r,function(o,s){o?(t.find('input[type="hidden"]').val(r),n(h(r)).insertAfter(f.closest(".input-group")),e.css("display","inline-block")):t.prepend(i(s));u.prop("disabled",!1);f.prop("disabled",!1)})}function k(t,i,r){n.ajax({url:"/Base/"+t,type:"POST",data:{fileUrl:r},success:function(n){i!=null&&i.html("<img class='img-circle' src='"+n+"' height='24' />")}})}var t={},r={init:o,disable:l,enable:s,reset:a};n.fn.imageupload=function(t){var i=arguments;return this.filter("div").each(function(){if(r[t])r[t].apply(n(this),Array.prototype.slice.call(i,1));else if(typeof t!="object"&&t)throw new Error('Method "'+t+'" is not defined for imageupload.');else r.init.apply(n(this),i)})};n.fn.imageupload.defaultOptions={allowedFormats:["jpg","jpeg","png"],maxWidth:200,maxHeight:200,maxFileSizeKb:2048,refreshImgById:null,ajaxSuccessMethode:null,refreshImgByjaxSuccessMethode:null}})(jQuery)